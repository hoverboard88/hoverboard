!function(e){e(function(){e.post(ajaxurl,{action:"wpcfm_load",compare_env:compare_env.env},function(n){e.each(n.bundles,function(n,l){var d=e(".bundles-hidden .bundle-row").clone();d.find(".bundle-label").val(l.label),d.find(".bundle-name").val(l.name),d.find(".bundle-select").val(l.config),d.find(".bundle-toggle").html(l.label),d.attr("data-bundle",l.name),l.is_file&&(d.find(".pull-bundle").removeClass("disabled"),d.find(".download-bundle").attr("href",l.url),d.find(".download-bundle").attr("download",l.url.split("/").reverse()[0]),d.find(".download-bundle").removeClass("hidden")),l.is_db&&d.find(".push-bundle").removeClass("disabled"),e(".wpcfm-bundles").append(d),d.find(".bundle-select").multiSelect()})},"json"),e(document).on("click",".wpcfm-save",function(){e(".wpcfm-response").html("Saving...");var n={bundles:[]};e(".wpcfm-bundles .bundle-row:not(.row-all)").each(function(){var l=e(this),d={label:l.find(".bundle-label").val(),name:l.find(".bundle-name").val(),config:l.find(".bundle-select").val()};n.bundles.push(d)}),e.post(ajaxurl,{action:"wpcfm_save",compare_env:compare_env.env,data:JSON.stringify(n)},function(n){e(".wpcfm-bundles .bundle-row").removeClass("unsaved"),e(".wpcfm-bundles .push-bundle").removeClass("disabled"),e(".wpcfm-response").html(n)})}),e(document).on("click",".add-bundle",function(){var n=e(".bundles-hidden").html();e(".wpcfm-bundles").append(n);var l=e(".wpcfm-bundles .bundle-row:last");l.find(".bundle-select").multiSelect(),l.addClass("unsaved"),l.find(".bundle-toggle").trigger("click")}),e(document).on("click",".hide-registered",function(n){n.preventDefault();var l=e(this).closest(".bundle-row");e(".wpcfm-bundles").find("input[type=checkbox]:checked").each(function(){l.find('input[type=checkbox][value="'+this.value+'"]').not(":checked").parent().hide()}),l.find(".hide-registered").hide(),l.find(".show-all").show()}),e(document).on("click",".show-all",function(n){n.preventDefault();var l=e(this).closest(".bundle-row");l.find("input[type=checkbox]").parent().show(),l.find(".hide-registered").show(),l.find(".show-all").hide()}),e(document).on("click",".bundle-row:not(.row-all) .bundle-toggle",function(){var n=e(this).closest(".bundle-row");n.toggleClass("active"),n.find(".bundle-row-inner").animate({height:"toggle"},150)}),e(document).on("click",".remove-bundle",function(){confirm("You are about to delete this bundle. Continue?")&&e(this).closest(".bundle-row").remove()}),e(document).on("click",".push-bundle:not(.disabled)",function(){e(".wpcfm-response").html("Exporting to file...");var n=e(this).closest(".bundle-row").attr("data-bundle");e.post(ajaxurl,{action:"wpcfm_push",compare_env:compare_env.env,data:{bundle_name:n}},function(n){e(".wpcfm-response").html(n)})}),e(document).on("click",".pull-bundle:not(.disabled)",function(){if(confirm("Import file settings to DB?")){e(".wpcfm-response").html("Importing into DB...");var n=e(this).closest(".bundle-row").attr("data-bundle");e.post(ajaxurl,{action:"wpcfm_pull",compare_env:compare_env.env,data:{bundle_name:n}},function(n){e(".wpcfm-response").html(n)})}}),e(document).on("click",".diff-bundle:not(.disabled)",function(){var n=e(this).closest(".bundle-row").attr("data-bundle");e.post(ajaxurl,{action:"wpcfm_diff",compare_env:compare_env.env,data:{bundle_name:n}},function(n){""!=n.error?e(".wpcfm-diff .diff").html(n.error):(e(".wpcfm-diff .original").text(n.file),e(".wpcfm-diff .changed").text(n.db),e(".wpcfm-diff").prettyTextDiff()),e(".media-modal").show(),e(".media-modal-backdrop").show()},"json")}),e(document).on("click",".media-modal-close",function(){e(".media-modal").hide(),e(".media-modal-backdrop").hide()}),e(document).on("keyup",".bundle-label",function(){var n=e(this).val(),l=n;l=(l=(l=(l=e.trim(l).toLowerCase()).replace(/[^\w- ]/g,"")).replace(/[- ]/g,"_")).replace(/[_]{2,}/g,"_"),e(this).siblings(".bundle-name").val(l),e(this).closest(".bundle-row").attr("data-bundle",l),e(this).closest(".bundle-row").find(".bundle-toggle").html(n)}),e("#wpcfm_env_switch").on("change",function(){window.location=window.location.href+"&compare_env="+e(this).val()})})}(jQuery);
