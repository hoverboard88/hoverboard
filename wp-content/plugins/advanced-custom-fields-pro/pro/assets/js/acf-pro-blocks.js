"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function t(e){return typeof e}:function t(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function t(e,n,o){var r=_superPropBase(e,n);if(r){var i=Object.getOwnPropertyDescriptor(r,n);return i.get?i.get.call(o):i.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)})(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function t(e,n){return e.__proto__=n,e})(t,e)}!function(t,e){function n(t){if(!wp||!wp.blocks||!wp.blocks.registerBlockType)return!1;if(t.post_types&&t.post_types.length){var e=acf.screen.getPostType();if(-1===t.post_types.indexOf(e))return!1}if("string"==typeof t.icon&&"<svg"===t.icon.substr(0,4)){var n=t.icon;t.icon=React.createElement(l,{html:n})}var o;return t=acf.parseArgs(t,{title:"",name:"",category:"",attributes:{id:{type:"string"},data:{type:"object"},name:{type:"string"},align:{type:"string"},mode:{type:"string"}},edit:function t(e){return React.createElement(s,e)},save:function t(){return null}}),c[t.name]=t,wp.blocks.registerBlockType(t.name,t)}function o(){var t=acf.get("blockTypes");t&&t.map(n)}function r(t){return c[t]||!1}function i(t){var e=wp.data.select("core/editor").getBlocks();for(var n in t)e=e.filter(function(e){return e.attributes[n]===t[n]});return e}function a(e,n){return t.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepareForAjax({action:"acf/ajax/fetch-block",block:e,query:n})})}var c={};acf.addAction("ready",o);var s=function(t){function e(t){var n;return _classCallCheck(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).setAttributes=n.setAttributes.bind(_assertThisInitialized(n)),n.toggleMode=n.toggleMode.bind(_assertThisInitialized(n)),n.setup(),n}return _inherits(e,t),_createClass(e,[{key:"setup",value:function t(){var e=this.props,n=e.name,o=e.attributes,a=r(n),c;o.id?i({id:o.id}).length>1&&(o.id="",this.setAttributes({id:acf.uniqid("block_")})):this.setAttributes({id:acf.uniqid("block_"),name:a.name,mode:a.mode,align:a.align,data:{}})}},{key:"setAttributes",value:function t(e){this.props.setAttributes(e)}},{key:"toggleMode",value:function t(){var e="preview"===this.props.attributes.mode?"edit":"preview";this.setAttributes({mode:e})}},{key:"render",value:function t(){var e=this.props,n=e.name,o=e.attributes,i=o.mode;if(!o.id)return null;var a=r(n),c=wp.element.Fragment,s=wp.editor,l=s.BlockControls,u=s.InspectorControls,p=wp.components,d=p.Toolbar,y=p.IconButton,m=p.PanelBody,b=p.Button,_="preview"===i?acf.__("Switch to Edit"):acf.__("Switch to Preview"),v="preview"===i?"edit":"welcome-view-site";return React.createElement(c,null,React.createElement(l,null,React.createElement(d,null,a.supports.mode&&React.createElement(y,{className:"components-icon-button components-toolbar__control",label:_,icon:v,onClick:this.toggleMode}))),React.createElement(u,null,React.createElement("div",{className:"acf-block-component acf-block-panel"},React.createElement("div",{className:"acf-block-panel-actions"},React.createElement(b,{className:"button",onClick:this.toggleMode},_)),"preview"===i&&React.createElement(f,this.props))),React.createElement("div",{className:"acf-block-component acf-block-body"},"preview"===i?React.createElement(h,this.props):React.createElement(f,this.props)))}}]),e}(React.Component),l=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"render",value:function t(){return React.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.html}})}}]),e}(React.Component),u={},p=function(e){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).setup(t),e}return _inherits(n,e),_createClass(n,[{key:"setup",value:function t(e){this.id=e.clientId}},{key:"$el",value:function t(){return u[this.id]}},{key:"setHTML",value:function e(n){u[this.id]=t(n),this.forceUpdate(),this.componentDidMount()}},{key:"render",value:function t(){var e=this,n=wp.components,o=n.Placeholder,r=n.Spinner;return this.$el()?React.createElement("div",{ref:function t(n){return e.el=n}}):React.createElement(o,null,React.createElement(r,null))}},{key:"componentDidMount",value:function e(){var n=this.$el();if(!n)return this.fetch();t(this.el).html(n),n.data("initialized")?this.onRefresh():(n.data("initialized",!0),this.onInitialize()),this.onRender()}},{key:"componentWillUnmount",value:function t(){acf.doAction("unmount",this.$el())}},{key:"onInitialize",value:function t(){acf.doAction("append",this.$el())}},{key:"onRefresh",value:function t(){acf.doAction("remount",this.$el()),acf.doAction("refresh",this.$el())}},{key:"onRender",value:function t(){}},{key:"fetch",value:function t(){}}]),n}(React.Component),f=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"setup",value:function t(e){this.id="BlockForm-".concat(e.clientId)}},{key:"fetch",value:function t(){var e=this,n;a(this.props.attributes,{form:!0}).done(function(t){e.setHTML(t.data.form)})}},{key:"onInitialize",value:function t(){_get(_getPrototypeOf(e.prototype),"onInitialize",this).call(this);var n=this.props,o=n.attributes,r=n.setAttributes,i=this.$el(),a=!1;i.on("change keyup",function(t){clearTimeout(a),a=setTimeout(function(){r({data:acf.serialize(i,"acf-".concat(o.id))})},300)})}}]),e}(p),h=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"setup",value:function t(e){this.id="BlockPreview-".concat(e.clientId)}},{key:"fetch",value:function t(){var e=this,n;a(this.props.attributes,{preview:!0}).done(function(t){e.setHTML(t.data.preview)})}},{key:"componentDidUpdate",value:function t(e){var n,o;JSON.stringify(e.attributes.data)!==JSON.stringify(this.props.attributes.data)&&this.fetch()}},{key:"onRender",value:function t(){acf.doAction("render_block_preview",this.$el(),this.props.attributes)}}]),e}(p)}(jQuery);